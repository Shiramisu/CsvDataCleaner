<Window x:Class="CsvDataCleaner.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:CsvDataCleaner.Models"
        xmlns:vms="clr-namespace:CsvDataCleaner.ViewModels"
        mc:Ignorable="d"
        Title="CSV Data Cleaner"
        Height="700"
        Width="1200"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource WindowBackgroundBrush}"
        Foreground="{DynamicResource WindowForegroundBrush}">

    <Window.DataContext>
        <vms:MainViewModel />
    </Window.DataContext>

    <DockPanel Margin="10">
        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,0,0,10">
            <Button Content="CSV öffnen"
                    Width="120"
                    Margin="0,0,10,0"
                    Command="{Binding OpenFileCommand}"/>
            <Button Content="Analysieren"
                    Width="120"
                    Margin="0,0,10,0"
                    Command="{Binding AnalyzeCommand}"
                    IsEnabled="{Binding HasData}"/>
            <Button Content="Auto-Fixes anwenden"
                    Width="150"
                    Margin="0,0,10,0"
                    Command="{Binding ApplyFixesCommand}"
                    IsEnabled="{Binding CanApplyFixes}"/>
            <Button Content="Bereinigte CSV exportieren"
                    Width="190"
                    Margin="0,0,10,0"
                    Command="{Binding ExportCleanedCommand}"
                    IsEnabled="{Binding HasData}"/>
            <Button Content="Issues exportieren"
                    Width="140"
                    Margin="0,0,10,0"
                    Command="{Binding ExportIssuesCommand}"
                    IsEnabled="{Binding HasIssues}"/>
            <CheckBox Content="Dark Mode"
                      Margin="20,0,0,0"
                      VerticalAlignment="Center"
                      IsChecked="{Binding IsDarkMode}"/>
        </StackPanel>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <Border Grid.Row="0" Padding="5" Margin="0,0,0,5" BorderBrush="Gray" BorderThickness="1">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="Datei:" FontWeight="Bold"/>
                    <TextBlock Text="{Binding FilePath}" Margin="5,0,0,0" TextTrimming="CharacterEllipsis"/>
                    <TextBlock Text=" | Qualität:" Margin="15,0,0,0" FontWeight="Bold"/>
                    <TextBlock Text="{Binding QualityDisplay}" Margin="5,0,0,0"/>
                    <TextBlock Text=" | Zeilen:" Margin="15,0,0,0" FontWeight="Bold"/>
                    <TextBlock Text="{Binding RowCount}" Margin="5,0,0,0"/>
                    <TextBlock Text=" | Issues:" Margin="15,0,0,0" FontWeight="Bold"/>
                    <TextBlock Text="{Binding IssueCount}" Margin="5,0,0,0"/>
                </StackPanel>
            </Border>

            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <GroupBox Header="CSV-Daten" Margin="0,0,5,0">
                    <DataGrid ItemsSource="{Binding CsvView}"
                              AutoGenerateColumns="True"
                              IsReadOnly="False"
                              CanUserAddRows="False"
                              CanUserDeleteRows="False"
                              Margin="5"/>
                </GroupBox>

                <TabControl Grid.Column="1" Margin="5,0,0,0">
                    <TabItem Header="Issues">
                        <DataGrid ItemsSource="{Binding Issues}"
                                  AutoGenerateColumns="False"
                                  IsReadOnly="True"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  Margin="5">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Typ" Binding="{Binding IssueType}" Width="Auto"/>
                                <DataGridTextColumn Header="Zeile" Binding="{Binding RowIndex}" Width="Auto"/>
                                <DataGridTextColumn Header="Spalte" Binding="{Binding ColumnName}" Width="*"/>
                                <DataGridTextColumn Header="Beschreibung" Binding="{Binding Description}" Width="2*"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </TabItem>

                    <TabItem Header="Regeln">
                        <DataGrid ItemsSource="{Binding Rules}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  Margin="5">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Spalte" Binding="{Binding ColumnName}" Width="*"/>
                                <DataGridComboBoxColumn Header="Typ"
                                                        SelectedItemBinding="{Binding RuleType}"
                                                        Width="Auto">
                                    <DataGridComboBoxColumn.ItemsSource>
                                        <x:Array Type="{x:Type vm:RuleType}">
                                            <vm:RuleType>Text</vm:RuleType>
                                            <vm:RuleType>Numeric</vm:RuleType>
                                            <vm:RuleType>Date</vm:RuleType>
                                        </x:Array>
                                    </DataGridComboBoxColumn.ItemsSource>
                                </DataGridComboBoxColumn>
                                <DataGridCheckBoxColumn Header="Pflichtfeld" Binding="{Binding IsRequired}" Width="Auto"/>
                                <DataGridTextColumn Header="Min (Num/Date)" Binding="{Binding MinValue}" Width="Auto"/>
                                <DataGridTextColumn Header="Max (Num/Date)" Binding="{Binding MaxValue}" Width="Auto"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </TabItem>
                </TabControl>
            </Grid>

            <StatusBar Grid.Row="2" Margin="0,5,0,0">
                <StatusBarItem>
                    <TextBlock Text="{Binding StatusText}"/>
                </StatusBarItem>
            </StatusBar>
        </Grid>
    </DockPanel>
</Window>
